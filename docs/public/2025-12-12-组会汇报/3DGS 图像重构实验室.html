<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3DGS ç»ˆææŒ‡å—ï¼šä»æ•°å­¦æ›²çº¿åˆ°é€¼çœŸä¸–ç•Œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- MathJax for Formulas -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f8fafc; }
        canvas { display: block; width: 100%; height: auto; background: #ffffff; border-radius: 8px; }
        .canvas-wrapper { position: relative; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        .control-group { background: white; padding: 1rem; border-radius: 8px; border: 1px solid #f1f5f9; margin-bottom: 1rem; }
        .nav-btn { transition: all 0.2s; }
        .nav-btn.active { background-color: #0f766e; color: white; border-color: #0f766e; }
        input[type=range] { width: 100%; accent-color: #0f766e; cursor: pointer; }
    </style>
</head>
<body class="text-slate-800">

    <div class="flex h-screen overflow-hidden flex-col md:flex-row">
        
        <!-- SIDEBAR NAVIGATION -->
        <div class="w-full md:w-64 bg-white border-r border-slate-200 flex-shrink-0 flex flex-col z-20 shadow-lg">
            <div class="p-6 border-b border-slate-100">
                <h1 class="text-xl font-bold text-teal-800">3DGS ç»ˆæåŸç†</h1>
                <p class="text-xs text-slate-500 mt-1">äº¤äº’å¼åŸç†è§£æ</p>
            </div>
            <nav class="flex-1 overflow-y-auto p-4 space-y-2">
                <button onclick="switchTab(1)" id="btn-1" class="nav-btn active w-full text-left px-4 py-3 rounded-lg border border-slate-200 hover:bg-slate-50 text-sm font-medium">
                    1. å‡ç»´ï¼šä» 1D åˆ° 3D
                    <div class="text-xs opacity-70 mt-1 font-normal">é«˜æ–¯çƒæ˜¯å¦‚ä½•è¯ç”Ÿçš„ï¼Ÿ</div>
                </button>
                <button onclick="switchTab(2)" id="btn-2" class="nav-btn w-full text-left px-4 py-3 rounded-lg border border-slate-200 hover:bg-slate-50 text-sm font-medium">
                    2. æ³¼æº…ï¼š3D æŠ•å½±åˆ° 2D
                    <div class="text-xs opacity-70 mt-1 font-normal">æ ¸å¿ƒæœºåˆ¶ï¼šåƒçš®å½±æˆä¸€æ ·æŠ•å½±</div>
                </button>
                <button onclick="switchTab(3)" id="btn-3" class="nav-btn w-full text-left px-4 py-3 rounded-lg border border-slate-200 hover:bg-slate-50 text-sm font-medium">
                    3. æˆç”»ï¼šæµ·é‡å åŠ 
                    <div class="text-xs opacity-70 mt-1 font-normal">ä»æ¨¡ç³Šè‰²æ–‘åˆ°æ¸…æ™°å›¾åƒ</div>
                </button>
            </nav>
            <div class="p-4 bg-slate-50 text-xs text-slate-400 border-t border-slate-100">
                3D Gaussian Splatting Visualization
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="flex-1 overflow-y-auto bg-slate-50 p-4 md:p-8 relative">
            
            <!-- SECTION 1: EVOLUTION -->
            <div id="section-1" class="section-content max-w-5xl mx-auto">
                <header class="mb-6">
                    <h2 class="text-3xl font-bold text-slate-800 mb-2">1. å‡ç»´ï¼šä» 1D æ›²çº¿åˆ° 3D è¿·é›¾</h2>
                    <p class="text-slate-600">
                        é«˜æ–¯å‡½æ•°ä¸ä»…ä»…æ˜¯ä¸€æ¡æ›²çº¿ã€‚å®ƒæ˜¯æè¿°â€œæ¦‚ç‡â€å’Œâ€œèŒƒå›´â€çš„é€šç”¨æ•°å­¦å·¥å…·ã€‚<br>
                        è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•ä¸€æ­¥æ­¥â€œé•¿â€æˆ 3DGS é‡Œçš„é‚£ä¸ªâ€œçƒâ€çš„ã€‚
                    </p>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- 1D View -->
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-teal-700">1D: æ¦‚ç‡æ›²çº¿</h3>
                            <span class="text-xs bg-slate-100 px-2 py-1 rounded">Xè½´</span>
                        </div>
                        <canvas id="canvas-1d" width="300" height="200"></canvas>
                        <p class="text-xs text-slate-500 mt-2">æè¿°ï¼šåœ¨ç›´çº¿ä¸Šï¼Œç‰©ä½“å¤§æ¦‚ç‡åœ¨å“ªé‡Œã€‚</p>
                    </div>

                    <!-- 2D View -->
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-teal-700">2D: æ¦‚ç‡å±±å³°</h3>
                            <span class="text-xs bg-slate-100 px-2 py-1 rounded">X, Yè½´</span>
                        </div>
                        <canvas id="canvas-2d" width="300" height="200"></canvas>
                        <p class="text-xs text-slate-500 mt-2">æè¿°ï¼šåœ¨å¹³é¢ä¸Šï¼Œåƒä¸€ä¸ªå±±ä¸˜ã€‚ä»ä¸Šå¾€ä¸‹çœ‹æ˜¯ä¸€ä¸ªæ¤­åœ†ã€‚</p>
                    </div>

                    <!-- 3D View -->
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-teal-700">3D: æ¦‚ç‡äº‘é›¾</h3>
                            <span class="text-xs bg-slate-100 px-2 py-1 rounded">X, Y, Zè½´</span>
                        </div>
                        <canvas id="canvas-3d-preview" width="300" height="200"></canvas>
                        <p class="text-xs text-slate-500 mt-2">æè¿°ï¼šåœ¨ç©ºé—´ä¸­ï¼Œåƒä¸€ä¸ªæµ“æ·¡ä¸ä¸€çš„æ©„æ¦„çƒã€‚è¿™å°±æ˜¯ 3DGS çš„åŸºç¡€å•å…ƒï¼</p>
                    </div>
                </div>

                <div class="control-group">
                    <h4 class="font-bold text-slate-700 mb-4">è¿›åŒ–æ§åˆ¶å™¨</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <label class="text-sm font-medium text-slate-600 mb-1 block">åˆ†æ•£ç¨‹åº¦ (Variance $\sigma^2$)</label>
                            <input type="range" id="slider-variance" min="10" max="80" value="30">
                            <p class="text-xs text-slate-400 mt-1">è¿™å†³å®šäº†ï¼šæ›²çº¿çš„èƒ–ç˜¦ / å±±å³°çš„åº•åº§å¤§å° / çƒä½“çš„å¤§å°</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-slate-600 mb-1 block">æ—‹è½¬/ç›¸å…³æ€§ (Correlation)</label>
                            <input type="range" id="slider-rotation" min="0" max="180" value="0">
                            <p class="text-xs text-slate-400 mt-1">è¿™å†³å®šäº†ï¼š2D/3D é«˜æ–¯çš„æ–¹å‘ã€‚æ•°å­¦ä¸Šå«â€œåæ–¹å·®â€ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION 2: PROJECTION (SPLATTING) -->
            <div id="section-2" class="section-content hidden max-w-6xl mx-auto">
                <header class="mb-6">
                    <h2 class="text-3xl font-bold text-slate-800 mb-2">2. æ³¼æº… (Splatting)ï¼š3D æŠ•å½±çš„é­”æ³•</h2>
                    <p class="text-slate-600">
                        è¿™æ˜¯ 3DGS æœ€æ ¸å¿ƒçš„é­”æ³•ã€‚æ€ä¹ˆæŠŠç©ºé—´é‡Œçš„ 3D çƒå˜æˆå±å¹•ä¸Šçš„ 2D å›¾åƒï¼Ÿ<br>
                        æƒ³è±¡ä¸€ä¸‹<strong>â€œçš®å½±æˆâ€</strong>ï¼š3D çƒæ˜¯ç‰©ä½“ï¼Œå±å¹•æ˜¯å¹•å¸ƒï¼Œå…‰æ …åŒ–å°±æ˜¯æŠ•å½±è¿‡ç¨‹ã€‚
                    </p>
                </header>

                <div class="flex flex-col lg:flex-row gap-8 items-stretch h-[500px]">
                    
                    <!-- Left: 3D World View -->
                    <div class="flex-1 bg-white rounded-xl shadow-lg border border-slate-200 flex flex-col overflow-hidden relative">
                        <div class="absolute top-4 left-4 z-10 bg-white/90 px-3 py-1 rounded shadow text-sm font-bold text-teal-700 border border-teal-100">
                            ğŸ¥ 3D ä¸–ç•Œè§†è§’
                        </div>
                        <div class="flex-1 relative bg-slate-50">
                            <canvas id="canvas-world-3d" class="w-full h-full cursor-move"></canvas>
                            <div class="absolute bottom-4 left-4 text-xs text-slate-400 pointer-events-none">
                                æ‹–æ‹½é¼ æ ‡æ—‹è½¬è§†è§’ï¼Œè§‚å¯Ÿè¿™ä¸ªâ€œé«˜æ–¯æ¤­çƒâ€
                            </div>
                        </div>
                    </div>

                    <!-- Arrow -->
                    <div class="flex items-center justify-center lg:flex-col text-slate-300">
                        <div class="text-center">
                            <div class="text-4xl font-bold">â”</div>
                            <div class="text-xs font-mono uppercase tracking-widest mt-1">Projection</div>
                        </div>
                    </div>

                    <!-- Right: 2D Screen View -->
                    <div class="flex-1 bg-white rounded-xl shadow-lg border border-slate-200 flex flex-col overflow-hidden relative">
                        <div class="absolute top-4 left-4 z-10 bg-white/90 px-3 py-1 rounded shadow text-sm font-bold text-amber-600 border border-amber-100">
                            ğŸ–¼ï¸ 2D å±å¹•è§†è§’ (Splat)
                        </div>
                        <div class="flex-1 flex items-center justify-center bg-black">
                            <!-- This simulates the screen rendering -->
                            <canvas id="canvas-screen-2d" width="400" height="400"></canvas>
                        </div>
                        <div class="p-4 bg-white border-t border-slate-100 text-sm text-slate-600">
                            <p><span class="font-bold text-amber-600">è¿™å°±æ˜¯â€œæ³¼æº…â€ï¼</span></p>
                            <p class="mt-1">
                                æ— è®º 3D çƒåœ¨ç©ºé—´é‡Œæ€ä¹ˆè½¬ï¼ŒæŠ•å½±åˆ°å±å¹•ä¸Šæ°¸è¿œæ˜¯ä¸€ä¸ª <strong>2D æ¤­åœ†</strong>ã€‚<br>
                                3DGS ç®—æ³•åªéœ€è¦ç®—å‡ºè¿™ä¸ª 2D æ¤­åœ†çš„å½¢çŠ¶å’Œé¢œè‰²ï¼Œå°±èƒ½å¿«é€Ÿç”»å‡ºæ¥ã€‚
                            </p>
                        </div>
                    </div>
                </div>

                <div class="mt-6 bg-blue-50 border border-blue-100 p-4 rounded-lg">
                    <h3 class="font-bold text-blue-800 text-sm mb-2">ğŸ“ åŸç†åˆ’é‡ç‚¹</h3>
                    <p class="text-sm text-blue-700 leading-relaxed">
                        è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ 3DGS è¿™ä¹ˆå¿«ã€‚å®ƒä¸éœ€è¦åƒ Ray Tracing é‚£æ ·è®¡ç®—å…‰çº¿åå°„ï¼Œä¹Ÿä¸éœ€è¦åƒ NeRF é‚£æ ·è·‘ç¥ç»ç½‘ç»œã€‚<br>
                        å®ƒåªéœ€è¦åšç®€å•çš„å‡ ä½•æŠ•å½±ï¼š<br>
                        1. æŠŠ 3D åæ–¹å·®çŸ©é˜µ ($\Sigma$) æŠ•å½±æˆ 2D åæ–¹å·®çŸ©é˜µ ($\Sigma'$).<br>
                        2. åœ¨å±å¹•ä¸Šç”»ä¸€ä¸ª 2D é«˜æ–¯è‰²å—ã€‚<br>
                        è¿™å°±å¥½æ¯”ï¼šæŠŠ 3D ç‰©ä½“æ‹æ‰äº†è´´åœ¨å±å¹•ä¸Šã€‚
                    </p>
                </div>
            </div>

            <!-- SECTION 3: COMPOSITION -->
            <div id="section-3" class="section-content hidden max-w-5xl mx-auto">
                <header class="mb-6">
                    <h2 class="text-3xl font-bold text-slate-800 mb-2">3. æˆç”»ï¼šæµ·é‡æ³¼æº…çš„è‰ºæœ¯</h2>
                    <p class="text-slate-600">
                        å•ä¸ª Splat åªæ˜¯ä¸€ä¸ªæ¨¡ç³Šçš„æ–‘ç‚¹ã€‚ä½†å½“æˆ‘ä»¬æœ‰å‡ ç™¾ä¸‡ä¸ª Splat æ—¶ï¼Œå¥‡è¿¹å°±å‘ç”Ÿäº†ã€‚<br>
                        å¤§çƒç”»èƒŒæ™¯ï¼Œå°çƒç”»ç»†èŠ‚ï¼Œå±‚å±‚å åŠ ï¼Œæœ€ç»ˆéª—è¿‡äººçœ¼ã€‚
                    </p>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                    <div class="lg:col-span-8">
                        <div class="canvas-wrapper bg-white">
                            <canvas id="canvas-composition" width="800" height="600"></canvas>
                            <div class="absolute bottom-4 right-4 bg-black/60 text-white px-3 py-1 rounded text-xs backdrop-blur-sm">
                                é«˜æ–¯çƒæ•°é‡: <span id="comp-count-display">100</span>
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-4 space-y-4">
                        <div class="control-group">
                            <label class="font-bold text-slate-700 text-sm block mb-2">é«˜æ–¯çƒæ•°é‡ (Density)</label>
                            <input type="range" id="comp-slider-count" min="50" max="5000" value="100" step="50">
                            <div class="flex justify-between text-xs text-slate-400 mt-1">
                                <span>æ¨¡ç³Š (å°‘)</span>
                                <span>æ¸…æ™° (å¤š)</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <label class="font-bold text-slate-700 text-sm block mb-2">é«˜æ–¯çƒå°ºå¯¸ (Scale)</label>
                            <input type="range" id="comp-slider-size" min="0.5" max="3" value="1.5" step="0.1">
                            <div class="flex justify-between text-xs text-slate-400 mt-1">
                                <span>ç²¾ç»† (å°)</span>
                                <span>è¦†ç›– (å¤§)</span>
                            </div>
                        </div>

                        <div class="bg-amber-50 p-4 rounded-lg border border-amber-100 text-xs text-amber-800 leading-relaxed">
                            <strong class="block mb-2 text-amber-900">è¯•è¯•çœ‹ï¼š</strong>
                            1. å…ˆæŠŠæ•°é‡æ‹‰åˆ°æœ€ä½ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªä¸ªç‹¬ç«‹çš„æ¤­åœ†ã€‚<br>
                            2. æ…¢æ…¢å¢åŠ æ•°é‡ï¼Œæ³¨æ„å®ƒä»¬æ˜¯å¦‚ä½•å¡«æ»¡ç©ºéš™çš„ã€‚<br>
                            3. æœ€åæŠŠå°ºå¯¸è°ƒå°ï¼Œæ•°é‡æ‹‰æ»¡ï¼Œè¿™å°±æ˜¯â€œé«˜æ¸…æ¸²æŸ“â€çš„ç§˜è¯€ã€‚
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- GLOBAL STATE & UTILS ---
        let currentTab = 1;
        
        function switchTab(tabId) {
            currentTab = tabId;
            // UI Update
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${tabId}`).classList.add('active');
            
            document.querySelectorAll('.section-content').forEach(s => s.classList.add('hidden'));
            document.getElementById(`section-${tabId}`).classList.remove('hidden');

            // Trigger Specific Renderers based on Tab
            if (tabId === 1) renderSection1();
            if (tabId === 2) initSection2();
            if (tabId === 3) initSection3();
        }

        // --- MATH HELPERS ---
        function gaussian(x, mu, sigma) {
            return Math.exp(-Math.pow(x - mu, 2) / (2 * Math.pow(sigma, 2)));
        }

        // --- SECTION 1: EVOLUTION (1D -> 3D) ---
        
        let s1_variance = 30;
        let s1_rotation = 0;

        function initSection1Listeners() {
            const vSlider = document.getElementById('slider-variance');
            const rSlider = document.getElementById('slider-rotation');
            
            vSlider.addEventListener('input', (e) => { s1_variance = parseInt(e.target.value); renderSection1(); });
            rSlider.addEventListener('input', (e) => { s1_rotation = parseInt(e.target.value); renderSection1(); });
        }

        function renderSection1() {
            // Canvas 1: 1D Line
            const c1 = document.getElementById('canvas-1d');
            const ctx1 = c1.getContext('2d');
            ctx1.clearRect(0,0,c1.width,c1.height);
            
            ctx1.beginPath();
            ctx1.strokeStyle = '#0f766e';
            ctx1.lineWidth = 3;
            const mu = c1.width / 2;
            for(let x=0; x<c1.width; x++) {
                const y = gaussian(x, mu, s1_variance) * (c1.height * 0.8);
                const plotY = c1.height - 10 - y;
                if(x===0) ctx1.moveTo(x, plotY); else ctx1.lineTo(x, plotY);
            }
            ctx1.stroke();
            // Axis
            ctx1.strokeStyle = '#ccc'; ctx1.lineWidth=1; ctx1.beginPath(); ctx1.moveTo(0, c1.height-10); ctx1.lineTo(c1.width, c1.height-10); ctx1.stroke();

            // Canvas 2: 2D Heatmap (Simplified)
            const c2 = document.getElementById('canvas-2d');
            const ctx2 = c2.getContext('2d');
            ctx2.clearRect(0,0,c2.width,c2.height);
            
            ctx2.save();
            ctx2.translate(c2.width/2, c2.height/2);
            ctx2.rotate(s1_rotation * Math.PI / 180);
            
            // Draw scaling ellipse to represent 2D Gaussian
            const scaleX = s1_variance * 1.5;
            const scaleY = s1_variance * 0.8; // Make it elliptical by default to show rotation
            
            // Multiple rings for contour
            [1, 0.7, 0.4].forEach((opacity, idx) => {
                ctx2.beginPath();
                ctx2.ellipse(0, 0, scaleX * (3-idx*0.8), scaleY * (3-idx*0.8), 0, 0, Math.PI*2);
                ctx2.fillStyle = `rgba(13, 148, 136, ${0.3})`;
                ctx2.fill();
                ctx2.strokeStyle = `rgba(13, 148, 136, 0.8)`;
                ctx2.stroke();
            });
            ctx2.restore();

            // Canvas 3: 3D Wireframe Preview (Fake 3D)
            const c3 = document.getElementById('canvas-3d-preview');
            const ctx3 = c3.getContext('2d');
            ctx3.clearRect(0,0,c3.width,c3.height);
            
            ctx3.save();
            ctx3.translate(c3.width/2, c3.height/2);
            
            // Draw a wireframe sphere that deforms based on variance
            const time = Date.now() * 0.001;
            const size = s1_variance * 1.5;
            
            // Rotate the whole view slowly
            const rotX = time * 0.5;
            const rotY = time * 0.3;

            // Simple Point Cloud Sphere Projection
            for(let i=0; i<100; i++) {
                // Random points on sphere surface
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(2 * Math.random() - 1);
                
                let x = size * Math.sin(phi) * Math.cos(theta);
                let y = (size * 0.6) * Math.sin(phi) * Math.sin(theta); // Flattened slightly
                let z = size * Math.cos(phi);

                // Apply user Rotation (Z-axis rotation from slider)
                const userRad = s1_rotation * Math.PI / 180;
                let tx = x * Math.cos(userRad) - y * Math.sin(userRad);
                let ty = x * Math.sin(userRad) + y * Math.cos(userRad);
                x = tx; y = ty;

                // Apply View Rotation (Animation)
                let y2 = y * Math.cos(rotX) - z * Math.sin(rotX);
                let z2 = y * Math.sin(rotX) + z * Math.cos(rotX);
                let x2 = x * Math.cos(rotY) - z2 * Math.sin(rotY);
                
                // Perspective project
                const scale = 200 / (200 + z2);
                const px = x2 * scale;
                const py = y2 * scale;

                // Draw Point
                ctx3.fillStyle = `rgba(15, 118, 110, ${scale})`;
                ctx3.beginPath();
                ctx3.arc(px, py, 1.5 * scale, 0, Math.PI*2);
                ctx3.fill();
            }
            ctx3.restore();

            if(currentTab === 1) requestAnimationFrame(renderSection1);
        }

        // --- SECTION 2: PROJECTION (The Splatting Logic) ---
        
        let s2_angleX = 0;
        let s2_angleY = 0;
        let isDragging = false;
        let lastMouseX, lastMouseY;

        function initSection2() {
            const canvas3d = document.getElementById('canvas-world-3d');
            
            canvas3d.addEventListener('mousedown', e => { isDragging = true; lastMouseX = e.clientX; lastMouseY = e.clientY; });
            window.addEventListener('mouseup', () => isDragging = false);
            window.addEventListener('mousemove', e => {
                if(!isDragging) return;
                const dx = e.clientX - lastMouseX;
                const dy = e.clientY - lastMouseY;
                s2_angleY += dx * 0.01;
                s2_angleX += dy * 0.01;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
            });

            renderSection2();
        }

        function renderSection2() {
            if(currentTab !== 2) return;

            const c3d = document.getElementById('canvas-world-3d');
            const ctx3d = c3d.getContext('2d');
            const c2d = document.getElementById('canvas-screen-2d');
            const ctx2d = c2d.getContext('2d');

            // Clear canvases
            ctx3d.clearRect(0,0,c3d.width, c3d.height);
            ctx2d.clearRect(0,0,c2d.width, c2d.height);
            ctx2d.fillStyle = '#000'; ctx2d.fillRect(0,0,c2d.width, c2d.height); // Screen black bg

            // --- 3D RENDER (The Ellipsoid) ---
            ctx3d.save();
            ctx3d.translate(c3d.width/2, c3d.height/2);
            
            // Draw Grid (Floor)
            ctx3d.strokeStyle = '#e2e8f0';
            ctx3d.beginPath();
            for(let i=-100; i<=100; i+=20) {
                // Project floor lines? Keep it simple: 2D grid that rotates
                // Let's just draw the object to avoid visual clutter
            }

            // Define Ellipsoid: A sphere scaled non-uniformly
            // Scale (fixed for this demo, visually distinct axes)
            const sx = 60, sy = 30, sz = 15; 
            
            // Create Vertices for Wireframe
            const vertices = [];
            for(let lat=0; lat <= Math.PI; lat+=Math.PI/8) {
                for(let lon=0; lon <= 2*Math.PI; lon+=Math.PI/8) {
                    const x = sx * Math.sin(lat) * Math.cos(lon);
                    const y = sy * Math.sin(lat) * Math.sin(lon);
                    const z = sz * Math.cos(lat);
                    vertices.push({x, y, z});
                }
            }

            // Project and Draw 3D View
            let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;

            vertices.forEach(v => {
                // Rotation Matrix (Mouse Control)
                let x = v.x; let y = v.y; let z = v.z;
                
                // Rot Y
                let tx = x * Math.cos(s2_angleY) - z * Math.sin(s2_angleY);
                let tz = x * Math.sin(s2_angleY) + z * Math.cos(s2_angleY);
                x = tx; z = tz;

                // Rot X
                let ty = y * Math.cos(s2_angleX) - z * Math.sin(s2_angleX);
                tz = y * Math.sin(s2_angleX) + z * Math.cos(s2_angleX);
                y = ty; z = tz;

                // 3D View Perspective
                const scale = 300 / (300 + z); // Perspective projection
                const px = x * scale;
                const py = y * scale;

                ctx3d.fillStyle = `rgba(13, 148, 136, ${0.6})`;
                ctx3d.fillRect(px, py, 2, 2);

                // Track bounding box for 2D splat estimation
                // Note: Real Splatting projects the covariance matrix. 
                // Visual Trick: The 2D projection is essentially the "Shadow" on the XY plane.
                // Since we rotated the points, x and y are now screen coordinates!
                if(x < minX) minX = x; if(x > maxX) maxX = x;
                if(y < minY) minY = y; if(y > maxY) maxY = y;
            });
            
            // Draw Axes in 3D View
            ctx3d.strokeStyle = 'red'; ctx3d.beginPath(); ctx3d.moveTo(0,0); ctx3d.lineTo(50,0); ctx3d.stroke(); // X
            ctx3d.strokeStyle = 'green'; ctx3d.beginPath(); ctx3d.moveTo(0,0); ctx3d.lineTo(0,50); ctx3d.stroke(); // Y
            ctx3d.restore();


            // --- 2D SPLAT RENDER (The Projection) ---
            // Based on the bounding box and orientation of the 3D cloud, we draw the 2D Splat
            ctx2d.save();
            ctx2d.translate(c2d.width/2, c2d.height/2);

            // Calculate approximated width/height/rotation from the projected points
            // This is a visual approximation of projecting the Covariance Matrix
            const width = (maxX - minX);
            const height = (maxY - minY);
            
            // Draw the splat
            const gradient = ctx2d.createRadialGradient(0, 0, 0, 0, 0, Math.max(width, height)/1.5);
            gradient.addColorStop(0, 'rgba(245, 158, 11, 1)'); // Amber center
            gradient.addColorStop(0.6, 'rgba(245, 158, 11, 0.4)');
            gradient.addColorStop(1, 'rgba(245, 158, 11, 0)');

            // We apply a slight rotation based on mouse angles to simulate the covariance skew
            ctx2d.rotate(s2_angleY * 0.5); // Simplified correlation visual
            
            // Draw Ellipse
            ctx2d.fillStyle = gradient;
            ctx2d.beginPath();
            ctx2d.ellipse(0, 0, width/1.5, height/1.5, 0, 0, Math.PI*2);
            ctx2d.fill();

            ctx2d.restore();

            requestAnimationFrame(renderSection2);
        }

        // --- SECTION 3: COMPOSITION (Sunset Demo) ---
        
        let splatData = [];
        
        function initSection3() {
            // Generate Splats (Sunset Scene)
            splatData = [];
            const width = 800, height = 600;
            
            // Sky
            for(let i=0; i<3000; i++) {
                const y = Math.random() * height * 0.6;
                splatData.push({
                    x: Math.random() * width,
                    y: y,
                    r: 20 + Math.random()*40, g: 30, b: 80 + Math.random()*50,
                    sx: 40 + Math.random()*40, sy: 20,
                    layer: 0
                });
            }
            // Sun
            for(let i=0; i<800; i++) {
                const angle = Math.random() * Math.PI * 2;
                const rad = Math.random() * 60;
                splatData.push({
                    x: width/2 + Math.cos(angle)*rad,
                    y: height*0.4 + Math.sin(angle)*rad,
                    r: 255, g: 150 + Math.random()*50, b: 0,
                    sx: 10, sy: 10,
                    layer: 1
                });
            }
            // Mountains
            for(let i=0; i<2000; i++) {
                const x = Math.random() * width;
                const h = 150 * Math.sin(x * 0.01) + Math.random()*20; // Sine wave mountain
                const y = height * 0.6 - h + Math.random() * 100;
                if(y > height * 0.6) continue;
                splatData.push({
                    x: x, y: y,
                    r: 20, g: 10, b: 30,
                    sx: 15, sy: 15,
                    layer: 2
                });
            }

            const sCount = document.getElementById('comp-slider-count');
            const sSize = document.getElementById('comp-slider-size');
            
            sCount.addEventListener('input', renderSection3);
            sSize.addEventListener('input', renderSection3);

            renderSection3();
        }

        function renderSection3() {
            const canvas = document.getElementById('canvas-composition');
            const ctx = canvas.getContext('2d');
            const count = parseInt(document.getElementById('comp-slider-count').value);
            const sizeScale = parseFloat(document.getElementById('comp-slider-size').value);
            
            document.getElementById('comp-count-display').innerText = count;

            ctx.fillStyle = 'white';
            ctx.fillRect(0,0,canvas.width, canvas.height);

            // Stride based rendering to maintain global distribution
            const step = Math.floor(splatData.length / count) || 1;
            
            for(let i=0; i<splatData.length; i+=step) {
                const s = splatData[i];
                ctx.beginPath();
                ctx.ellipse(s.x, s.y, s.sx*sizeScale, s.sy*sizeScale, 0, 0, Math.PI*2);
                ctx.fillStyle = `rgba(${s.r},${s.g},${s.b}, 0.5)`;
                ctx.fill();
            }
        }

        // --- INIT ---
        window.onload = function() {
            initSection1Listeners();
            switchTab(1); // Start at tab 1
        };

    </script>
</body>
</html>